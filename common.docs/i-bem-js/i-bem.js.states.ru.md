<a name="states"></a>
## Состояния блока

Проектируя динамический блок в стиле БЭМ, нужно представить всю логику
изменений, происходящих в нем, как набор **состояний** блока. Тогда
поведение блока определяется **триггерами** — callback-функциями, которые
выполняются при переходе блока из одного состояния в другое.

Это позволяет писать код блока в декларативном стиле как набор утверждений вида: `описание состояния` — `действия, выполняемые при переходе в данное состояние`.

<a name="modifiers"></a>
### Модификаторы

Согласно БЭМ-методологии, состояние блока и его элементов описывается
**модификаторами**.

Модификатор указывает, в каком из возможных состояний находится блок. Модификатор представляет собой пару: **имя** и **значение**. Список допустимых значений модификатора описывает набор состояний блока. Например, для описания размеров блока
можно использовать модификатор `size` с допустимыми значениями `s`, `m` и
`l`.

**Простой модификатор** — частный случай, когда важно только наличие
или отсутствие модификатора у блока, а его значение несущественно. Например, модификатор описывающий состояние «отключен»: `disabled`. В `i-bem.js` представлены как модификаторы с булевым значением. При выставлении модификатора с неуказанным значением
`i-bem.js` автоматически присваивает ему значение `true`.

Каждому блоку можно установить один или несколько модификаторов. Блок
может не иметь модификаторов. Список допустимых модификаторов и их
значений определяет разработчик блока.

В `i-bem.js` модификаторы устанавливаются при
[инициализации экземпляра блока](#init) (если модификаторы и их
значения указаны в атрибуте `class` соответствующего HTML-элемента).

**NB** Если модификаторы блока указаны в HTML-элементе, при
инициализации блока триггеры на установку данных модификаторов *не
выполняются*. Экземпляр блока в этом случае получает начальное
состояние, а не меняет его.

Модификаторы могут добавляться, удаляться и менять значения:

* в ходе выполнения кода блока (например, как реакция на [DOM-события](#dom-events));
* по запросу из другого блока (см. раздел [Взаимодействие блоков](#ibc)).

При добавлении, удалении и изменении значений модификаторов выполняются [триггеры](#mods-api-trigger).

<a name="mods-api"></a>
#### Управление модификаторами

Экземпляр блока предоставляет методы для установки, удаления и проверки значений его модификаторов.

**NB** Для изменения значений модификаторов используйте описанный ниже API экземпляра блока. Не следует устанавливать модификаторы, самостоятельно изменяя CSS-классы соответствующего DOM-узла.

Доступен следующий набор методов для управления модификаторами:

* `hasMod([elem], modName, [modVal])` – проверяет наличие модификатора. Возвращает `true` если модификатор `modName` установлен.
* `getMod([elem], modName)` – возвращает строку со значеним модификатор `modName`.
* `getMods([elem], [...modNames])` – возвращает хэш со значениями всех модификаторов блока и его элементов. Можно ограничить действие метода указав нужный элемент `[elem]` или `[...modNames]` – строку с именами модификаторов разделенными пробелом.
* `setMod([elem], modName, [modVal=true])` – устанавливает блоку (элементу) модификатор `modName`. Если не указана строка со значением `[modVal=true]` будет установлен *простой модификатор*.
* `toggleMod([elem], modName, modVal1, [modVal2], [condition])` – переключает значения модификатора. Если аргумент `[modVal2]` передан, то между `modVal1` и `[modVal2]`, если нет будет поочередно устанавливаться и удаляться `modVal1`.
* `delMod([elem], modName)` – удаляет у блока модификатор `modName`.

**Пример:** Экземпляр блока `square` может по клику на DOM-элементе блока переключаться между значениями `green` и `red` модификатора `color`, если не выставлен модификатор `disabled`:

```js
BEMDOM.decl('square', {
    onSquareClick: function(e) {
        if(!this.hasMod('disabled')) {
            this.toggleMod('color', 'green', 'red');
        }
    }
});
```


Эти же методы позволяют управлять модификаторами элементов блока. Для этого первым аргументом передается ссылка на **DOM-узел элемента** (а не имя элемента).

Иначе возникла бы неоднозначность: имеется в виду установка блоку *модификатора* `input` со значением `clean` или установка элементу `input` *простого модификатора* `clean`.

**Пример:** Блок `searchbox` по клику может выставлять своему элементу `input` простой модификатор `clean` (подразумеваемое значение — `true`):

```js
BEMDOM.decl('searchbox', {
    _onClick: function() {
        this.setMod(this.elem('input'), 'clean');
    }
});
```


Полное описание API для управления модификаторами приведено в
исходном коде модулей [i-bem][] и [i-bem__dom][].

<a name="mods-api-trigger"></a>
### Триггеры на установку модификаторов

Выполнение триггеров на установку модификаторов разбито на две фазы:

1. **До установки модификатора**. Эта фаза зарезервирована для
возможности **отменить** установку модификатора. Если хотя бы один
из триггеров, выполняемых в этой фазе, вернет `false`,
установки модификатора не произойдет.
2. **После установки модификатора**. Триггеры, выполняемые в этой
фазе, уже не могут отменить установку модификаторов.

Триггеры могут быть привязаны к следующим типам изменений значений модификаторов:

1. установка *любого* модификатора в *любое* значение;
2. установка *конкретного* модификатора `modName` в *любое* значение (в том числе
установка простого модификатора в значение `true`);
3. установка *конкретного* модификатора `modName` в *конкретное* значение `modVal`;
4. установка модификатора в значение `''` (пустая строка), что
эквивалентно удалению модификатора или установке простого
модификатора в значение `false`.

При установке модификатора `modName` в значение `modVal` триггеры
каждой фазы (если они определены) вызываются в том порядке, в котором они
перечислены в приведенном выше списке событий (от общего к частному).

Таким образом, при определении триггера пользователь указывает:

* фазу выполнения (до или после установки модификатора);
* тип события (имя и устанавливаемое значение модификатора).

<a name="mods-api-trigger-phase"></a>
#### Фазы выполнения

Дополнительная фазы, предшествующая установке модификатора, позволяет
произвести некоторые проверки без риска повлиять на логику, связанную с установкой модификатора. Например, если существуют взаимоисключающие модификаторы, перед установкой одного из них логично проверить не установлен ли другой.

В блоке `checkbox-group` библиотеки `bem-components` перед установкой модификатора `focused` производится проверка на наличие модификатора `disabled`:

```js
provide(BEMDOM.decl(this.name, {
    beforeSetMod : {
        'focused' : {
            'true' : function() {
                return !this.hasMod('disabled');
            }
        }
    },

    onSetMod : {
        'focused' : { /* ... */}
    }
}));
```


Если триггер для фазы, предшествующей установке (`beforeSetMod`), возвращает `false`, установка модификатора не производится.

Подробнее об использовании триггеров читайте в разделе [Декларация триггеров](#trigger-decl)

#### Примеры триггеров

Типовая задача триггеров, вызываемых после установки модификатора или
изменения его значения (свойство `onSetMod`) — выполнить операции над
DOM-узлом блока, необходимые для перехода в новое состояние.

**Пример:** Экземпляр блока `input` при установке простого
модификатора `focused` (в значение `true`) очищает поле ввода —
заменяет пустой строкой текст DOM-узла блока.

```js
BEMDOM.decl('input', {
    onSetMod : {
        'focused' : {
            'true' : function() {
                this.domElem.val(''); // очистить поле ввода
            }
        }
    }
});
```


Триггеры, выполняемые перед установкой модификатора (свойство `beforeSetMod`), служат для проверки текущего состояния экземпляра блока и возможности отменить переход в другое состояние.

**Пример:** Экземпляр блока `input` перед установкой простого
модификатора `focused` проверяет, не выставлен ли у него модификатор
`disabled`. Если `disabled` выставлен, будет возвращено значение `false` и
установки модификатора `focused` не произойдет.

```js
BEMDOM.decl('input', {
    beforeSetMod : {
        'focused' : {
            'true' : function() {
                return !this.hasMod('disabled'); // вернет false, если disabled
            }
        }
    }
});
```
